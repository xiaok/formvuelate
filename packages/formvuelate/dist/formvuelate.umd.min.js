!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).Formvuelate={},e.Vue)}(this,(function(e,n){"use strict";function t(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function r(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function i(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(l)throw a}}}}var l="fvl_",u="".concat(l,"isSchemaWizard"),s="".concat(l,"parentSchemaExists"),m="".concat(l,"injectedSchema"),d="".concat(l,"schemaModelPath"),f="".concat(l,"formModel"),p="".concat(l,"findNestedFormModelProp"),h="".concat(l,"updateFormModel"),v="".concat(l,"deleteFormModelProp"),y="".concat(l,"parseSubSchemaForms"),S="".concat(l,"injectedLocalComponents"),b=Object.freeze({__proto__:null,IS_SCHEMA_WIZARD:u,PARENT_SCHEMA_EXISTS:s,INJECTED_SCHEMA:m,SCHEMA_MODEL_PATH:d,FORM_MODEL:f,FIND_NESTED_FORM_MODEL_PROP:p,UPDATE_FORM_MODEL:h,DELETE_FORM_MODEL_PROP:v,LOOKUP_PARSE_SUB_SCHEMA_FORMS:y,INJECTED_LOCAL_COMPONENTS:S});function g(){var e=Math.floor(1e9*Math.random()),n=new Map;return{UUID:e,UUIDBindings:n,getID:function(t){return n.has(t)?n.get(t):(e++,n.set(t,e),e)}}}var O=function(e){return e.filter((function(e){return e.schema}))},C=function e(n,t){var r=function(e){var n,t=i(e);try{for(t.s();!(n=t.n()).done;){var r=n.value,o=O(r);if(o.length)return o}}catch(e){t.e(e)}finally{t.f()}return[]}(t),o=function(e){return(null==e?void 0:e.model)===n};if(!r.length)return null;var a,c=i(r);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(o(l))return l;var u=e(n,j(l.schema));if(o(u))return u}}catch(e){c.e(e)}finally{c.f()}return null},j=function(e){return(Array.isArray(e)?e:Object.keys(e).map((function(n){return r(r({},e[n]),{},{model:n})}))).map((function(e){return Array.isArray(e)?e:[e]}))};var M={name:"SchemaField",props:{field:{type:Object,required:!0},sharedConfig:{type:Object,default:()=>({})},preventModelCleanupOnSchemaChange:{type:Boolean,default:!1}},setup(e){const t=n.computed((()=>e.field.schema?{...e.field,nestedSchemaModel:e.field.model}:{...e.sharedConfig,...e.field})),r=n.inject(f,{}),o=n.inject(d,null),a=n.inject(p),c=n.computed((()=>o?a(r,o)[e.field.model]:r.value[e.field.model])),i=n.inject(h),l=n.inject(v),u=n.computed((()=>{const n=e.field.condition;return!n||"function"!=typeof n||n(r.value)})),s=n.inject(S,{}),m=n.computed((()=>s[e.field.component]||e.field.component));return n.watch(u,(n=>{n||e.preventModelCleanupOnSchemaChange||l(r,e.field.model,o)})),{binds:t,fieldValue:c,update:n=>{i(r,e.field.model,n,o)},schemaCondition:u,component:m}}};M.render=function(e,t,r,o,a,c){return o.schemaCondition?(n.openBlock(),n.createBlock(n.resolveDynamicComponent(o.component),n.mergeProps({key:0},o.binds,{modelValue:o.fieldValue,"onUpdate:modelValue":o.update,class:"schema-col"}),null,16,["modelValue","onUpdate:modelValue"])):n.createCommentVNode("v-if",!0)},M.__file="packages/formvuelate/src/SchemaField.vue";var P={name:"SchemaRow",components:{SchemaField:M},props:{row:{type:Array,required:!0},schemaRowClasses:{type:[String,Object,Array],default:null}},setup(e){const t=n.inject(f,{});return{rowHasVisibleElements:n.computed((()=>{for(const n of e.row){if(!n.condition)return!0;if("function"!=typeof condition&&!0===n.condition(t.value))return!0}return!1}))}}};P.render=function(e,t,r,o,a,c){const i=n.resolveComponent("SchemaField");return o.rowHasVisibleElements?(n.openBlock(),n.createBlock("div",{key:0,class:["schema-row",r.schemaRowClasses]},[(n.openBlock(!0),n.createBlock(n.Fragment,null,n.renderList(r.row,(t=>(n.openBlock(),n.createBlock(i,n.mergeProps({key:t.model,field:t},e.$attrs,{class:"schema-col"}),null,16,["field"])))),128))],2)):n.createCommentVNode("v-if",!0)},P.__file="packages/formvuelate/src/SchemaRow.vue";var F=function(e,n){return e[n]||(e[n]={}),e[n]},_=function(e,n){for(var t=n.split("."),r=F(e.value,t[0]),o=1;o<t.length;o++)r=F(r,t[o]);return r},k=function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r?_(e,r)[n]=t:e.value[n]=t},w=function(e,n,t){if(t){delete _(e,t)[n];var r=t.split("."),o=r.pop(),a=A(r.join("."),e.value);a&&!Object.keys(a[o]).length&&delete a[o]}else delete e.value[n]},E=function e(t,r){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=j(n.unref(t)),l=i(c);try{for(l.s();!(o=l.n()).done;){var u,s=o.value,m=a,d=i(s);try{for(d.s();!(u=d.n()).done;){var f=u.value;f.schema&&(m=""===m?f.model:"".concat(m,".").concat(f.model),e(f.schema,r,m)),r(f,m)}}catch(e){d.e(e)}finally{d.f()}}}catch(e){l.e(e)}finally{l.f()}},A=function(e,n){return e.split(".").reduce((function(e,n){return e[n]}),n)},B=function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=n.unref(t);for(var i in c){var l=c[i];if("object"===o(l)&&null!==l)return e(l,r,a=""===a?i:"".concat(a,".").concat(i));r(i,l,a)}};function D(e,t){var r=n.inject(f,{});n.inject(s,!1)||(E(t,(function(e,n){"default"in e&&k(r,e.model,e.default,n)})),n.watch(t,(function(n,t){e.preventModelCleanupOnSchemaChange||B(r,(function(e,t,o){var a=!1;E(n,(function(n){n.model===e&&(a=!0)}),o),a||w(r,e,o)}))})))}var R={name:"SchemaForm",components:{SchemaRow:P},props:{schema:{type:[Object,Array],required:!0,validator:e=>!Array.isArray(e)||(0===e.length||0===e.filter((e=>!Array.isArray(e)&&!e.model&&!e.schema)).length)},sharedConfig:{type:Object,default:()=>({})},preventModelCleanupOnSchemaChange:{type:Boolean,default:!1},nestedSchemaModel:{type:String,default:""},schemaRowClasses:{type:[String,Object,Array],default:null},useCustomFormWrapper:{type:Boolean,default:!1},debug:{type:Boolean,default:!1}},emits:["submit","update:modelValue"],setup(e,{emit:t,attrs:o}){const{behaveLikeParentSchema:a,hasParentSchema:c}=function(){var e=n.inject(u,!1),t=n.inject(s,!1);return t||n.provide(s,!0),{behaveLikeParentSchema:n.computed((function(){return!e&&!t})),hasParentSchema:t,isChildOfWizard:e}}(),{schema:i}=function(e,t){var r=n.toRefs(e).schema,o=n.inject(m,!1);if(t&&(n.provide(m,r),o=r),e.nestedSchemaModel){var a=n.inject(d,""),c=a?"".concat(a,".").concat(e.nestedSchemaModel):e.nestedSchemaModel;n.provide(d,c)}return{schema:o}}(e,a),{parsedSchema:l}=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=g().getID,a=n.inject(y,null),c=n.computed((function(){var c=n.unref(e),i=j(c);if(t){var l=C(t,i);l&&(i=j(l.schema))}return i=i.map((function(e){return e.map((function(e){var n=r({},e);return r(r({},n),{},{uuid:o(e.model)})}))})),a?a.remapSubSchemaForms(i,a.SchemaFormWithPlugins):i}));return{parsedSchema:c}}(i,o.model);D(e,l);const f=n.computed((()=>c&&!e.useCustomFormWrapper?{}:{onSubmit:e=>{e.preventDefault(),t("submit",e)}})),p=n.computed((()=>({})));return{behaveLikeParentSchema:a,parsedSchema:l,hasParentSchema:c,formBinds:f,slotBinds:p}}};const L={key:1};R.render=function(e,t,r,o,a,c){const i=n.resolveComponent("SchemaRow");return n.openBlock(),n.createBlock(n.resolveDynamicComponent(o.behaveLikeParentSchema&&!r.useCustomFormWrapper?"form":"div"),o.formBinds,{default:n.withCtx((()=>[o.behaveLikeParentSchema?n.renderSlot(e.$slots,"beforeForm",n.mergeProps({key:0},o.slotBinds)):n.createCommentVNode("v-if",!0),(n.openBlock(!0),n.createBlock(n.Fragment,null,n.renderList(o.parsedSchema,((e,t)=>(n.openBlock(),n.createBlock(i,{key:t,row:e,schemaRowClasses:r.schemaRowClasses,sharedConfig:r.sharedConfig,preventModelCleanupOnSchemaChange:r.preventModelCleanupOnSchemaChange},null,8,["row","schemaRowClasses","sharedConfig","preventModelCleanupOnSchemaChange"])))),128)),r.debug?(n.openBlock(),n.createBlock("pre",L,n.toDisplayString(o.parsedSchema),1)):n.createCommentVNode("v-if",!0),o.behaveLikeParentSchema?n.renderSlot(e.$slots,"afterForm",n.mergeProps({key:2},o.slotBinds)):n.createCommentVNode("v-if",!0)])),_:3},16)},R.__file="packages/formvuelate/src/SchemaForm.vue";var V={name:"SchemaWizard",components:{SchemaForm:R},props:{schema:{type:Array,required:!0},step:{type:Number,required:!0,default:0}},emits:["submit"],setup(e){n.provide(u,!0);return{currentSchema:n.computed((()=>e.schema[e.step]))}}};function N(e){return null!==e&&!!e&&"object"===o(e)&&!Array.isArray(e)}V.render=function(e,t,r,o,a,c){const i=n.resolveComponent("SchemaForm");return n.openBlock(),n.createBlock("form",{onSubmit:t[1]||(t[1]=n.withModifiers((n=>e.$emit("submit",n)),["prevent"]))},[n.renderSlot(e.$slots,"beforeForm"),n.createVNode(i,{schema:o.currentSchema,preventModelCleanupOnSchemaChange:""},null,8,["schema"]),n.renderSlot(e.$slots,"afterForm")],32)},V.__file="packages/formvuelate/src/SchemaWizard.vue",e.SchemaForm=R,e.SchemaFormFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=R.setup,a=r({},R.props);function c(e){N(e)?Object.assign(a,e):process.env&&"production"!==process.env.NODE_ENV&&console.warn("FormVueLate: extendSchemaFormProps can only receive a Vue props object")}function i(r,a){var c=o(r,a);return t&&(n.inject(S,null)||n.provide(S,t)),e.length?e.reduce((function(e,n){return n(e,r,a)}),c):c}return e.forEach((function(e){e.extend&&e.extend({extendSchemaFormProps:c})})),r(r({},R),{},{props:a,components:r(r({},t),R.components),name:"SchemaFormWithPlugins",setup:i})},e.SchemaWizard=V,e.constants=b,e.default=R,e.definePlugin=function(e){if("function"==typeof e)return e;var n=e.setup;return"extend"in e&&(n.extend=e.extend),n},e.useSchemaForm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.isRef(e)?e:n.ref(e);n.provide(h,k),n.provide(v,w),n.provide(p,_),n.provide(f,t);var r=function(e,n){if("string"!=typeof e)throw new Error("path for updateFormModel should be a string separated by dots (.)");var r=e.includes(".")?e.split(".").pop():e;k(t,r,n,e.split(".").slice(0,-1).join("."))};return{formModel:t,updateFormModel:r}},Object.defineProperty(e,"__esModule",{value:!0})}));